# Initial Setup

## Modern JavaScript Setup

If you are unfamiliar with the setup for a web application using JavaScript, the introduction to [Modern JavaScript explained for dinosaurs](https://peterxjang.com/blog/modern-javascript-explained-for-dinosaurs.html) is highly recommended, not only for dinosaurs but also for beginners. 

This project uses `pnpm` as the [package manager](https://peterxjang.com/blog/modern-javascript-explained-for-dinosaurs.html#using-a-javascript-package-manager-(npm)). Since mixing package managers can cause conflicts in the `package.json`, it is recommended to stick with `pnpm` when working on **Firn**. `pnpm` will help you install, update, and manage the dependencies (external libraries and tools) that our project needs.

## Switch to Node version 24

To use Node version 24, using [nvm](https://github.com/nvm-sh/nvm) (Node Version Manager) is recommended, which allows you to easily install and switch between different Node.js versions. If you don't have nvm installed, you can install it [as described](https://github.com/nvm-sh/nvm?tab=readme-ov-file#installing-and-updating).

Then you can switch to Node version 24 with:

```bash
nvm use 24
```

## Set up pnpm

First, install pnpm if you haven't already:

```bash
# Using npm to install pnpm globally
npm install -g pnpm

# On macOS, you can also use Homebrew
brew install pnpm
```

Then install the project dependencies:

```bash
pnpm install
```

## Environment configuration

This application requires a number of environment variables to be set. Copy the [`.env.example`](.env.example) file to `.env` and enter the required configuration values.

The most important values to be set are:

### Nuxt cryptographic secrets

These values are used for sealed session cookies and token generation. Possession of these secrets will allow decryption of tokens and cookies generated by the app, or enable generation of valid tokens.

Rotating these secrets will invalidate all existing sessions and tokens.

```console
NUXT_SESSION_PASSWORD=
NUXT_SESSION_SALT=
```

### OAuth configuration

Since the app does not manage its own user accounts or passwords, OAuth App secrets are required. [Google OAuth is mandatory](./auth.md), while GitHub is optional.

```console
NUXT_OAUTH_GOOGLE_CLIENT_ID=
NUXT_OAUTH_GOOGLE_CLIENT_SECRET=
```

## Database setup

Firn uses [CouchDB](./couchDatabase.md) to store information about users and the inventory. For development, a [local installation of CouchDB is recommended](https://couchdb.apache.org). After you have completed the installation and created an account, fill in the credentials in your environment file.

### Configuration

The database connection is configured through environment variables:

- `CLOUDANT_URL`: CouchDB server URL (default: http://localhost:5984)
- `CLOUDANT_USERNAME`: Username for authentication
- `CLOUDANT_PASSWORD`: Password for authentication
- `CLOUDANT_DATABASE`: Database name (default: 'firn')

Set these in your application's environment, e.g. by using the `.env`.

### Testing Database Connection

To test your database connection, run:

```bash
pnpm db:test
```

### Initialize Database

To create the first administrator user, you need to set the environment variable `FIRST_ADMIN_EMAIL` to a valid `@scilifelab.se` email address, for example `firn.user@scilifelab.se`. Then you can run the database initialization script:

```bash
pnpm db:init
```

This will create the respective administrator account in the database, unless an administrator already exists. In that case, ask an administrator to create or approve your account via the user interface instead.

## Development Server

Start the development server on `http://localhost:3000`:

```bash
pnpm dev
```

The development server includes:
- Hot module replacement (HMR) for instant updates
- Nuxt Developer Tools (see [Debugging](./debugging.md))
- TypeScript support with auto-imports
- ESLint integration

## Available Scripts

The project includes several useful scripts:

- `pnpm dev` - Start the development server
- `pnpm build` - Build the application for production
- `pnpm typecheck` - Run TypeScript type checking
- `pnpm lint` - Run ESLint to check code quality
- `pnpm db:init` - Initialize the database and create the first admin user
- `pnpm db:test` - Test the database connection

For more information about production builds, see [Deployment](./deployment.md).

## TypeScript

This project uses TypeScript for type safety. Type checking is enabled during the build process. To manually check types during development, run:

```bash
pnpm typecheck
```

Auto-imports are configured, so many functions and components are available without explicit imports. See the [TypeScript documentation](./typescript.md) for more details.

## Linting

The project uses ESLint for code quality. The linter runs automatically during development. To manually run the linter:

```bash
pnpm lint
```

## Next Steps

After completing the setup:

1. Verify your database connection with `pnpm db:test`
2. Initialize the database with `pnpm db:init` (if you're the first developer)
3. Start the development server with `pnpm dev`
4. Open `http://localhost:3000` in your browser
5. Log in using your Google account (with `@scilifelab.se` email)

For debugging tips and common issues, see the [Debugging guide](./debugging.md).
